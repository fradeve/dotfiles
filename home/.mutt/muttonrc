#-----------------------------------------------------
# General Mutt settings
#-----------------------------------------------------
set header_cache=$HOME/.mutt/cache/headers
set message_cachedir=$HOME/.mutt/cache/bodies
set certificate_file=$HOME/.mutt/certificates
set maildir_header_cache_verify=no
set tmpdir=$HOME/.mutt
set ssl_force_tls=yes

set copy=no 					# evita che mutt salvi le mail inviate in un file locale (nella home)
set move = no					# confirm when appending messages to an existing mailbox?
set delete=yes					# cancella senza chiederlo
set include=yes					# quota i messaggi alla risposta
set beep=no					# niente rumore
set markers=no					# non aggiungere un "+" quando vai a capo
set mail_check=5 	      			# check for new mail every 5 seconds
set confirmappend=no     			# confirm when appending messages to an existing mailbox?
auto_view text/html				# visualizza allegati html con visualizzatore definito in .mailcap
set pager_stop=yes				# prevents pager from jumping to the next message at the bottom of the current one
set auto_tag=yes				# functions in the index menu which affect a message will be applied to all tagged messages [press t]

set reply_to=ask-yes				# imposta la scelta del destinatario in caso di molteplici Reply-to:
set recall=no					# quando ci sono bozze, annulla la richiesta di richiamo della bozza ogni volta che si compone un nuovo messaggio
set abort_unmodified=no                         # if yes, composition will automatically abort after editing the message body if no changes are made to the file
set sort=threads				# fa in modo di visualizzare i thread ordinati per data-ultima-risposta-in-cima
set sort_aux=reverse-date-received		# come sopra

set imap_check_subscribed=yes			# automatically poll subscribed mailboxes for new mail
set imap_keepalive=30				# keep imap connection alive by polling intermittently (time in seconds)

set query_command="goobook query '%s'		# interroga goobook per la rubrica di gmail
bind editor <Tab> complete-query		# come sopra

set mime_forward = ask-no			# se YES forwarda il messaggio come allegato MIME: chi lo riceve lo vede come noi lo abbiamo ricevuto [default: no]

set ispell = "/usr/bin/aspell --mode=email check --lang=it_IT"		# path programma e parametri per il correttore ortografico [default: ispell]
set followup_to=yes				# settaggi per le ML
set honor_followup_to=yes			# come sopra
unset metoo					# evita l'inclusione del proprio indirizzo in CC o TO
alternates fradeve11@gmail.com			# come sopra
alternates francesco.devirgilio@inventati.org
alternates fradeve@inventati.org

set edit_headers=yes

set print_command="a2ps -o - -1gEmail --borders=no --strip=3 | ps2pdf - $HOME/mail.pdf && okular $HOME/mail.pdf"

#-----------------------------------------------------
# GPG settings 
#-----------------------------------------------------
# numero di secondi superati i quali la pw viene cancellata dalla cache
set pgp_timeout=300				
# comando ed opzioni per decodificare allegati nel formato deprecato application/pgp
set pgp_decode_command="gpg %?p?--passphrase-fd 0? --no-verbose --batch --output - %f"		
# comando e opzioni per verificare firme in formato PGP/MIME
set pgp_verify_command="gpg --no-verbose --batch --status-fd 2 --output - --verify %s %f"	
# comando e opzioni per decifrare un messaggio criptato in formato PGP/MIME
set pgp_decrypt_command="gpg --passphrase-fd 0 --no-verbose --batch --output - %f"		
# comando e opzioni per firmare un messaggio allegando la firma in formato PGP/MIME
set pgp_sign_command="gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --detach-sign --textmode %?a?-u %a? %f"	
# create a application/pgp signed (old-style) message
set pgp_clearsign_command="gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --textmode --clearsign %?a?-u %a? %f"	
# comando e opzioni per importare nel portafoglio di chiavi pubbliche la chiave in un messaggio firmato ricevuto
set pgp_import_command="gpg --no-verbose --import -v %f"	
# comando e opzioni per verificare le informazioni su una chiave attraverso il menu di selezione chiavi.
set pgp_verify_key_command="gpg --no-verbose --batch --fingerprint --check-sigs %r"	
# read in the public key ring
set pgp_list_pubring_command="gpg --no-verbose --batch --quiet --with-colons --list-keys %r" 
# read in the secret key ring
set pgp_list_secring_command="gpg --no-verbose --batch --quiet --with-colons --list-secret-keys %r" 
# fetch keys
set pgp_getkeys_command="/usr/bin/gpg --keyserver search.keyserver.net --recv-key %r"
# create a pgp/mime encrypted attachment
set pgp_encrypt_only_command="/usr/bin/pgpewrap gpg --batch --quiet --no-verbose --output - --encrypt --textmode --armor --always-trust -- -r %r -- %f"
# create a pgp/mime encrypted and signed attachment
set pgp_encrypt_sign_command="/usr/bin/pgpewrap gpg %?p?--passphrase-fd 0? --batch --quiet --no-verbose --textmode --output - --encrypt --sign %?a?-u %a? --armor --always-trust -- -r %r -- %f"
set pgp_good_sign="`gettext -d gnupg -s 'Good signature from "' | tr -d '"'`"

# auto sign when replying to signed message
set pgp_replysign=yes
# auto encrypt when replying to encrypted message
set pgp_replyencrypt=yes
# auto sign when replying to encrypted message (cohoperates with pgp_replysign)
set pgp_replysignencrypted=yes

#-----------------------------------------------------
# Mutt-patched sidebar
#-----------------------------------------------------
#set sidebar_width=35			# larghezza della sidebar
#set sidebar_visible=no			# sidebar visible at startup
#set sidebar_sort=yes			# unchecked because sorting is manual ("mailboxes" command)
#color sidebar_new yellow default	# colore cartelle con nuovi messaggi

#-----------------------------------------------------
# Look and feel
#-----------------------------------------------------
set date_format = "%d.%m.%y, %H:%M"
set locale = "it_IT.ISO-8859-1"

# definisce le visualizzazioni standard per tutte le cartelle
set index_format = "%2M %Z %{%d/%m/%y} %-25.25n %?X?[%X]&   ? %s"
set status_format = "%f [THIS MAILBOX -- Msgs:%?M?%M/?%m%?n? | New:%n?%?o? | Old:%o?%?d? | Del:%d?%?F? | Flag:%F?%?t? | Tag:%t?%?p? | Post:%p?%?b? | Dim:%l?] [ALL BOXES -- with news:%b]----%>-(%P)---"
set pager_format = "[STATUS %Z] [THREAD:%e/%E] [INDEX:%C/%m] %-20.20n %s"

set sig_dashes = yes 					# if YES Mutt inserts a line containing '-- ' before $signature
set pager_context = 2					# n of rows of the previous page to show in the following page during messa reading [default: 0]
macro pager l "|urlview\n" "gestisce url con urlview"	# enables a list of the links in the message, selection and running with the proper program

# defines what kind of attachments to show in index count
attachments   +A image/jpeg
attachments   +I application/octet-stream
attachments   +A application/zip
attachments   -I text/plain			# useful to not show attached signatures from ML
mime_lookup application/octet-stream		# sets Mutt to link file extension to mime.types for specified attachment

ignore *							
unignore Subject: Date: From: Reply-To: To: Cc: Bcc: X-Operating-System: X-Mailer: User-Agent:

unhdr_order *						
hdr_order Subject: Date: From: Reply-To: To: Cc: Bcc: X-Operating-System: X-Mailer: User-Agent:

#-----------------------------------------------------
# Process the password file first
#-----------------------------------------------------
set my_pass1=`awk '/fradeve_gmail:/ {print $2}' ~/.keys/mutt/muttpass`
set my_pass2=`awk '/fradeve_inventati:/ {print $2}' ~/.keys/mutt/muttpass`
set my_pass3=`awk '/fradeve_riseup:/ {print $2}' ~/.keys/mutt/muttpass`
set my_pass4=`awk '/mariacristinadeleo:/ {print $2}' ~/.keys/mutt/muttpass`

#-----------------------------------------------------
# Account Hooks
#-----------------------------------------------------
account-hook . 'unset imap_user imap_pass'	# unset first!
account-hook 'imaps://fradeve11@imap.gmail.com/' "\
              set imap_user='fradeve11' imap_pass=$my_pass1 "
account-hook 'imaps://francesco.devirgilio@inventati.org@mail.autistici.org/' "\
              set imap_user='francesco.devirgilio@inventati.org' imap_pass=$my_pass2 "
account-hook 'imaps://fradeve@mail.riseup.net/' "\
              set imap_user='fradeve@mail.riseup.net' imap_pass=$my_pass3 "
account-hook 'imaps://mariacristinadeleo@imap.gmail.com/' "\
              set imap_user='mariacristinadeleo' imap_pass=$my_pass4 "

#-----------------------------------------------------
# Folders, mailboxes and folder hooks
#-----------------------------------------------------
folder-hook 'imaps://fradeve11@imap.gmail.com/' \
'source $HOME/.mutt/accounts/conf_on_fradeve11atgmaildotcom'
folder-hook 'imaps://francesco.devirgilio@inventati.org@mail.autistici.org/' \
'source $HOME/.mutt/accounts/conf_on_inventati'
folder-hook 'imaps://fradeve@mail.riseup.net/' \
'source $HOME/.mutt/accounts/conf_on_riseup'
folder-hook 'imaps://mariacristinadeleo@imap.gmail.com/' \
'source $HOME/.mutt/accounts/conf_on_mariacristinadeleo'
# set the startup directory:
source $HOME/.mutt/accounts/conf_on_inventati

#-----------------------------------------------------
# Global macros to make life easier
#-----------------------------------------------------
# GPG
macro pager G "v<return><save-message>/tmp/test<return> !gpg -d /tmp/test && shred /tmp/test<return>q" # decrypt and show encrypted message
bind compose P pgp-menu

# macro to save all picture attachments
set pipe_decode = no
macro index Z "|munpack -C ~/Downloads\n"
macro pager Z "|munpack -C ~/Downloads\n"

# macro to quick change directory
macro index	<esc>1	\
'<sync-mailbox><enter-command>source ~/.mutt/accounts/conf_on_fradeve11atgmaildotcom<enter><change-folder>!<enter>'# ESC+1 takes to first INBOX
macro index	<esc>2	\
'<sync-mailbox><enter-command>source ~/.mutt/accounts/conf_on_inventati<enter><change-folder>!<enter>'		# ESC+2 takes to second INBOX
macro index	<esc>3	\
'<sync-mailbox><enter-command>source ~/.mutt/accounts/conf_on_riseup<enter><change-folder>!<enter>'		# ESC+3 takes to third INBOX
macro index	<esc>4	\
'<sync-mailbox><enter-command>source ~/.mutt/accounts/conf_on_mariacristinadeleo<enter><change-folder>!<enter>'	# ESC+4 takes to fourth INBOX
macro index	.r	"T.*\n;WN;WO^T.*\n"				# marks all messages as read

macro index,pager A '<sidebar-scroll-up>'				# A scrolls sidebar up
macro index,pager S '<sidebar-scroll-down>'				# S scrolls sidebar down
macro index,pager B '<enter-command>toggle sidebar_visible<enter>' 	# B hide-unhide sidebar

#-----------------------------------------------------
# Colors
#-----------------------------------------------------
source $HOME/.mutt/colors/mutt-colors-solarized-dark-16
